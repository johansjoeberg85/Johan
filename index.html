<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Lag & R√§tt ‚Äì Superquiz</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #fef3c7, #e5e7eb, #111827);
    }

    .game-container {
      background: rgba(255,255,255,0.98);
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(15,23,42,0.35);
      width: min(900px, 95vw);
      padding: 24px 28px 28px;
      position: relative;
      overflow: hidden;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title span.icon { font-size: 1.7rem; }

    .stats {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1e40af;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge.level { background:#ecfdf3; color:#166534; }
    .badge.streak { background:#fef3c7; color:#92400e; }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #f97316, #ef4444);
      transition: width 0.25s ease-out;
    }

    .card {
      background: #f9fafb;
      border-radius: 18px;
      padding: 16px 18px;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
    }

    .question-index {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .question-text {
      font-size: 1.05rem;
      font-weight: 600;
      color: #111827;
    }

    .choices {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 12px 0;
    }

    @media (max-width: 700px) {
      .choices { grid-template-columns: 1fr; }
    }

    .choice-btn {
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      background: white;
      padding: 10px 12px;
      text-align: left;
      cursor: pointer;
      font-size: 0.95rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    .choice-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(148,163,184,0.45);
    }

    .choice-btn.correct {
      border-color: #16a34a;
      background: #dcfce7;
    }

    .choice-btn.wrong {
      border-color: #dc2626;
      background: #fee2e2;
    }

    .choice-btn.disabled {
      pointer-events: none;
      opacity: 0.85;
    }

    .feedback {
      min-height: 48px;
      font-size: 0.95rem;
      border-radius: 14px;
      padding: 10px 12px;
      background: #eff6ff;
      color: #1e40af;
      border: 1px solid #dbeafe;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .feedback-icon { font-size: 1.4rem; margin-top: 2px; }

    .controls {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-top: 14px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .bottom-restart {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 18px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.07s ease, box-shadow 0.07s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(22,163,74,0.55);
    }

    .btn-secondary {
      background: #eef2ff;
      color: #3730a3;
    }

    .btn-secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(129,140,248,0.4);
    }

    .summary-list {
      margin-top: 20px;
      text-align: left;
      padding: 0;
      list-style: none;
    }

    .summary-item {
      padding: 10px;
      border-radius: 12px;
      margin-bottom: 8px;
      background: #f3f4f6;
      cursor: pointer;
    }

    .summary-item.correct { border-left: 6px solid #16a34a; }
    .summary-item.wrong  { border-left: 6px solid #dc2626; }

    .detail-box {
      background: white;
      border: 1px solid #d1d5db;
      padding: 14px;
      border-radius: 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="game-container">

  <div class="game-header">
    <div class="title">
      <span class="icon">‚öñÔ∏è</span>
      <span>Lag & R√§tt ‚Äì Superquiz</span>
    </div>
    <div class="stats">
      <div class="badge score" id="scoreBadge">‚≠ê Po√§ng: 0</div>
      <div class="badge level" id="levelBadge">üèÜ Niv√•: 1</div>
      <div class="badge streak" id="streakBadge">üî• Streak: 0</div>
    </div>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div id="quizArea">
    <div class="card" id="questionCard">
      <div class="question-index" id="questionIndex">Fr√•ga 1</div>
      <div class="question-text" id="questionText">Klicka p√• "Starta spelet"</div>
    </div>

    <div class="choices" id="choicesContainer"></div>

    <div class="feedback" id="feedbackBox">
      <span class="feedback-icon" id="feedbackIcon">üéÆ</span>
      <span id="feedbackText">Du kommer att f√• fr√•gor om lag och r√§tt.</span>
    </div>

    <div class="controls">
      <button class="btn btn-secondary" id="hintButton" disabled>üí° Visa st√∂dord</button>
      <button class="btn btn-primary" id="nextButton">‚ñ∂Ô∏è Starta spelet</button>
    </div>

    <div class="bottom-restart">
      <button class="btn btn-secondary" id="restartButton">üîÅ B√∂rja om</button>
    </div>
  </div>

<script>
  let answerLog = [];

  const cards = [
    {
      q: "Hur skiljer sig tingsr√§tten, hovr√§tten och H√∂gsta domstolen √•t?",
      options: [
        "Tingsr√§tten √§r f√∂rsta domstolen, hovr√§tten pr√∂var √∂verklaganden och H√∂gsta domstolen tar bara upp f√•, extra viktiga m√•l.",
        "Hovr√§tten √§r f√∂rsta domstolen, tingsr√§tten √∂verklagar domar och H√∂gsta domstolen d√∂mer bara ungdomar.",
        "Alla tre domstolar g√∂r exakt samma sak men ligger i olika delar av landet.",
        "Tingsr√§tten d√∂mer bara i brottm√•l, hovr√§tten bara i tvistem√•l och H√∂gsta domstolen bara i trafikm√•l."
      ],
      correct: 0,
      hint: "‚öñÔ∏è f√∂rsta instans, √∂verklagande, prejudikat",
      explain: "Tingsr√§tten √§r f√∂rsta instans. Hovr√§tten √§r n√§sta steg vid √∂verklagande och H√∂gsta domstolen v√§ljer n√•gra m√•l som ska ge v√§gledning (prejudikat)."
    },
    {
      q: "Varf√∂r kan vissa m√•l tas upp i H√∂gsta domstolen?",
      options: [
        "F√∂r att domstolen kan ge pr√∂vningstillst√•nd n√§r m√•let √§r viktigt f√∂r hur lagen ska tolkas i framtiden.",
        "F√∂r att alla som √§r missn√∂jda automatiskt f√•r sitt m√•l pr√∂vat en tredje g√•ng.",
        "F√∂r att H√∂gsta domstolen m√•ste ta upp alla grova brott oavsett vad.",
        "F√∂r att politiker best√§mmer att vissa personer ska f√• en extra chans."
      ],
      correct: 0,
      hint: "üé´ pr√∂vningstillst√•nd",
      explain: "H√∂gsta domstolen ger pr√∂vningstillst√•nd i m√•l som kan bli v√§gledande. D√§rf√∂r tas bara vissa fall upp."
    },
    {
      q: "Varf√∂r √§r det viktigt att kunna √∂verklaga en dom?",
      options: [
        "En h√∂gre domstol kan kontrollera om n√•got blivit fel och g√∂ra en ny bed√∂mning av bevisen.",
        "Det g√∂r att den som d√∂mts alltid slipper straffet direkt.",
        "Det g√∂r att man kan v√§lja vilken domare man vill ha.",
        "Det √§r bara en formalitet och p√•verkar aldrig domen."
      ],
      correct: 0,
      hint: "üîÅ kontroll, minska fel",
      explain: "M√∂jligheten att √∂verklaga g√∂r att en h√∂gre domstol kan r√§tta till fel och d√§rmed √∂ka r√§ttss√§kerheten."
    },
    {
      q: "Vad g√∂r polisen i en f√∂runders√∂kning?",
      options: [
        "Samlar bevis, h√•ller f√∂rh√∂r och f√∂rs√∂ker ta reda p√• vad som h√§nt och vem som kan vara misst√§nkt.",
        "Best√§mmer vilket straff den misst√§nkte ska f√•.",
        "Skriver lagar som riksdagen sedan r√∂star om.",
        "Best√§mmer om domen f√•r √∂verklagas eller inte."
      ],
      correct: 0,
      hint: "üîç utreda brott",
      explain: "Under f√∂runders√∂kningen utreder polisen brottet genom att samla bevis och prata med personer som kan veta n√•got."
    },
    {
      q: "Vilken roll har √•klagaren f√∂re r√§tteg√•ngen?",
      options: [
        "Leder delar av utredningen, bed√∂mer bevisen och best√§mmer om √•tal ska v√§ckas.",
        "Skriver lagar och skickar dem till riksdagen.",
        "F√∂rsvarar alltid den misst√§nkte mot polisen.",
        "Best√§mmer var r√§tteg√•ngen ska h√•llas men f√•r inte ta del av bevisen."
      ],
      correct: 0,
      hint: "üìÑ leder √•talet",
      explain: "√Öklagaren samarbetar med polisen, granskar bevisen och avg√∂r om det finns tillr√§ckligt underlag f√∂r √•tal."
    },
    {
      q: "Varf√∂r √§r det domstolen som beslutar om h√§ktning?",
      options: [
        "F√∂r att en oberoende domstol ska pr√∂va om det finns tillr√§ckliga sk√§l att l√•sa in n√•gon innan r√§tteg√•ng.",
        "F√∂r att polisen aldrig f√•r ta n√•gra beslut i en utredning.",
        "F√∂r att alla som √§r misst√§nkta automatiskt ska h√§ktas utan pr√∂vning.",
        "F√∂r att √•klagaren inte f√•r se vilka bevis polisen har samlat in."
      ],
      correct: 0,
      hint: "‚öñÔ∏è frihetsber√∂vande kr√§ver pr√∂vning",
      explain: "H√§ktning √§r ett stort ingrepp i en persons frihet. D√§rf√∂r m√•ste domstolen, som √§r oberoende, besluta om det."
    },
    {
      q: "N√§r blir en misst√§nkt en tilltalad?",
      options: [
        "N√§r √•klagaren v√§cker √•tal och l√§mnar in √§rendet till domstolen.",
        "N√§r polisen f√∂rsta g√•ngen st√§ller en fr√•ga till personen.",
        "N√§r n√•gon skriver om personen i tidningen.",
        "N√§r domen i H√∂gsta domstolen har best√§mts."
      ],
      correct: 0,
      hint: "üìÑ √•tal v√§cks",
      explain: "Den som √•klagaren v√§cker √•tal mot kallas tilltalad, eftersom domstolen d√• ska pr√∂va om personen √§r skyldig."
    },
    {
      q: "Vad g√∂r domaren under en r√§tteg√•ng?",
      options: [
        "Leder r√§tteg√•ngen, ser till att reglerna f√∂ljs och √§r med och best√§mmer dom och p√•f√∂ljd.",
        "F√∂rsvarar alltid den tilltalade mot √•klagaren.",
        "Samlar in bevis ute p√• brottsplatsen under tiden r√§tteg√•ngen p√•g√•r.",
        "Best√§mmer vilka lagar som ska g√§lla i Sverige fram√∂ver."
      ],
      correct: 0,
      hint: "‚öñÔ∏è leder och d√∂mer",
      explain: "Domaren leder huvudf√∂rhandlingen och √§r en av dem som best√§mmer om den tilltalade √§r skyldig och vilket straff som ska ges."
    },
    {
      q: "Vilken roll har n√§mndem√§n i r√§tteg√•ngar?",
      options: [
        "De √§r vanliga medborgare som sitter med domaren och √§r med och best√§mmer skuld och straff.",
        "De √§r experter p√• bevisteknik som analyserar platsen f√∂r brottet.",
        "De √§r vittnen som alltid ber√§ttar vad som h√§nt.",
        "De √§r politiker som skriver nya lagar under r√§tteg√•ngen."
      ],
      correct: 0,
      hint: "üë• lekm√§n som d√∂mer",
      explain: "N√§mndem√§n har ingen juridisk utbildning men √§r med och d√∂mer tillsammans med domaren f√∂r att representera allm√§nheten."
    },
    {
      q: "Vilken uppgift har f√∂rsvarsadvokaten?",
      options: [
        "Att hj√§lpa den tilltalade, f√∂rklara vad som h√§nder och se till att r√§tteg√•ngen blir r√§ttvis.",
        "Att f√∂rs√∂ka ge den tilltalade s√• h√•rt straff som m√∂jligt.",
        "Att leda polisens utredning och samla bevis.",
        "Att best√§mma om fallet ska tas upp i H√∂gsta domstolen."
      ],
      correct: 0,
      hint: "üõ°Ô∏è skydda den tilltalade",
      explain: "F√∂rsvarsadvokaten ska se till att den tilltalades r√§ttigheter tas tillvara och att allt g√•r r√§tt till i processen."
    },
    {
      q: "Vad √§r ett vittnes ansvar i domstol?",
      options: [
        "Att s√• noggrant som m√∂jligt ber√§tta sanningen om det man har sett, h√∂rt eller upplevt.",
        "Att alltid st√∂tta √•klagarens version oavsett vad man minns.",
        "Att best√§mma hur l√•ngt f√§ngelsestraffet ska bli.",
        "Att v√§lja vilka bevis som f√•r anv√§ndas i r√§tteg√•ngen."
      ],
      correct: 0,
      hint: "üó£Ô∏è tala sanning",
      explain: "Ett vittne m√•ste tala sanning. Att ljuga i domstol kallas mened och √§r ett brott."
    },
    {
      q: "Hur skiljer sig ett brottm√•l fr√•n ett tvistem√•l?",
      options: [
        "Brottm√•l g√§ller brott som till exempel st√∂ld eller misshandel, tvistem√•l g√§ller oenighet mellan personer, ofta om pengar eller avtal.",
        "Brottm√•l g√§ller bara tvister om pengar, tvistem√•l g√§ller bara grova v√•ldsbrott.",
        "Brottm√•l tas upp i domstol, tvistem√•l f√•r aldrig avg√∂ras av domstol.",
        "Brottm√•l handlar alltid om f√∂retag, tvistem√•l handlar alltid om privatpersoner."
      ],
      correct: 0,
      hint: "üöî brott vs üí¨ oenighet",
      explain: "I brottm√•l pr√∂vas om n√•gon har beg√•tt ett brott. I tvistem√•l avg√∂r domstolen en tvist mellan personer eller f√∂retag."
    },
    {
      q: "Varf√∂r f√∂rs√∂ker domaren ofta f√• parterna att n√• f√∂rlikning i ett tvistem√•l?",
      options: [
        "F√∂r att parterna sj√§lva kan komma √∂verens och slippa en l√•ng och dyr r√§tteg√•ng.",
        "F√∂r att domaren annars inte f√•r vara med i m√•let.",
        "F√∂r att det d√• inte l√§ngre √§r ett tvistem√•l utan ett brottm√•l.",
        "F√∂r att domstolen alltid m√•ste slippa att d√∂ma i civila m√•l."
      ],
      correct: 0,
      hint: "ü§ù komma √∂verens",
      explain: "En f√∂rlikning betyder att parterna g√•r med p√• en l√∂sning sj√§lva. Det sparar tid och pengar och alla vet vad de sagt ja till."
    },
    {
      q: "Vad √§r b√∂ter och dagsb√∂ter?",
      options: [
        "B√∂ter √§r en best√§md summa pengar, medan dagsb√∂ter √§r ett antal dagar g√•nger ett belopp som anpassas efter inkomsten.",
        "B√∂ter √§r f√§ngelse p√• kort tid, dagsb√∂ter betyder att man bara sitter inne p√• dagarna.",
        "B√∂ter √§r ett straff f√∂r vuxna och dagsb√∂ter √§r bara f√∂r ungdomar.",
        "B√∂ter anv√§nds bara i tvistem√•l och dagsb√∂ter bara i idrottsm√•l."
      ],
      correct: 0,
      hint: "üí∞ fast vs inkomst",
      explain: "Dagsb√∂ter g√∂r att den som tj√§nar mer betalar mer, s√• straffet blir mer r√§ttvist mellan olika personer."
    },
    {
      q: "Vad inneb√§r ett f√§ngelsestraff i Sverige?",
      options: [
        "Att den d√∂mde sitter inl√•st under en best√§md tid och ibland kan sl√§ppas fri villkorligt efter en del av tiden.",
        "Att den d√∂mde m√•ste betala tillbaka hela sin l√∂n men f√•r bo hemma.",
        "Att personen alltid sitter i f√§ngelse hela livet utan chans att komma ut.",
        "Att personen bara m√•ste sova i f√§ngelse men √§r helt fri p√• dagarna utan regler."
      ],
      correct: 0,
      hint: "üîê inl√•st viss tid",
      explain: "F√§ngelse inneb√§r att man f√∂rlorar sin frihet under en tid. Ofta kan man bli villkorligt frigiven efter en del av straffet."
    },
    {
      q: "Varf√∂r finns det b√•de √∂ppna och slutna anstalter?",
      options: [
        "F√∂r att anpassa s√§kerhetsniv√•n efter hur allvarligt brottet √§r och vilken risk den d√∂mde bed√∂ms ha.",
        "F√∂r att m√§n bara f√•r sitta i √∂ppna anstalter och kvinnor bara i slutna.",
        "F√∂r att korta straff alltid avtj√§nas i slutna anstalter och l√•nga straff alltid i √∂ppna.",
        "F√∂r att personer under 18 √•r bara f√•r vara i slutna anstalter."
      ],
      correct: 0,
      hint: "üîí olika s√§kerhet",
      explain: "Slutna anstalter har h√•rdare kontroll. √ñppna anstalter har l√§gre s√§kerhet och anv√§nds n√§r risken anses mindre."
    },
    {
      q: "Vad betyder det att alla ska behandlas lika inf√∂r lagen?",
      options: [
        "Att ingen ska f√• f√∂rdelar eller nackdelar p√• grund av till exempel k√∂n, bakgrund eller ekonomi.",
        "Att alla alltid f√•r exakt samma straff oavsett vilket brott som beg√•tts.",
        "Att domstolarna ska d√∂ma h√•rdare mot personer som har mycket pengar.",
        "Att bara svenska medborgare har r√§tt till en r√§ttvis r√§tteg√•ng."
      ],
      correct: 0,
      hint: "‚öñÔ∏è ingen s√§rbehandling",
      explain: "Lagen ska g√§lla lika f√∂r alla. Domstolen f√•r inte ta h√§nsyn till vem personen √§r n√§r de d√∂mer."
    },
    {
      q: "Hur kan oberoende domstolar och √∂ppna r√§tteg√•ngar √∂ka r√§ttss√§kerheten?",
      options: [
        "Domstolarna √§r fria fr√•n p√•verkan och allm√§nheten kan se hur r√§tteg√•ngarna g√•r till, vilket minskar risken f√∂r fusk.",
        "Politiker kan best√§mma domen i f√∂rv√§g s√• att allt g√•r snabbare.",
        "R√§tteg√•ngarna h√•lls hemliga s√• att ingen kan kontrollera vad som h√§nder.",
        "√Öklagaren f√•r best√§mma b√•de dom och straff utan domstolens inblandning."
      ],
      correct: 0,
      hint: "üîç insyn + oberoende",
      explain: "N√§r domstolen √§r oberoende och r√§tteg√•ngen oftast √§r offentlig blir det sv√•rare att fuska eller d√∂ma or√§ttvist."
    },
    {
      q: "Hur utses n√§mndem√§n och varf√∂r √§r deras roll viktig?",
      options: [
        "De v√§ljs av politiska partier i kommun och region och √§r vanliga medborgare som ska representera folket i domstolen.",
        "De lottas fram bland personer som sitter i f√§ngelse.",
        "De utses av polisen i varje enskilt brottm√•l.",
        "De √§r domare som har l√§st extra mycket juridik."
      ],
      correct: 0,
      hint: "üë• politiskt valda lekm√§n",
      explain: "N√§mndem√§n √§r lekm√§n som valts politiskt. De g√∂r att d√∂mandet inte bara sk√∂ts av jurister utan √§ven av vanliga medborgare."
    },
    {
      q: "Vilka f√∂rdelar och nackdelar kan olika p√•f√∂ljder ha?",
      options: [
        "Olika p√•f√∂ljder passar olika situationer, till exempel kan b√∂ter r√§cka vid mindre brott medan f√§ngelse eller samh√§llstj√§nst kan beh√∂vas i andra fall.",
        "Det √§r alltid b√§st med f√§ngelse oavsett brott eftersom alla d√• behandlas exakt likadant.",
        "B√∂ter √§r alltid or√§ttvist eftersom rika personer aldrig beh√∂ver betala dem.",
        "Samh√§llstj√§nst fungerar bara om den d√∂mde redan har ett heltidsjobb."
      ],
      correct: 0,
      hint: "üìä r√§tt straff till r√§tt l√§ge",
      explain: "Systemet har flera olika p√•f√∂ljder s√• att domstolen kan v√§lja det straff som passar b√§st i den aktuella situationen."
    },
    {
      q: "Vilka problem kan uppst√• i ett samh√§lle om r√§ttss√§kerheten brister?",
      options: [
        "M√§nniskor kan d√∂mas utan tillr√§ckliga bevis, behandlas olika och tappa f√∂rtroendet f√∂r domstolar och myndigheter.",
        "R√§tteg√•ngarna blir n√•got snabbare men alla k√§nner st√∂rre trygghet.",
        "Alla brott slutar automatiskt med b√∂ter i st√§llet f√∂r f√§ngelse.",
        "Det blir f√∂rbjudet att √∂verklaga domar och alla k√§nner mer f√∂rtroende f√∂r systemet."
      ],
      correct: 0,
      hint: "‚ö†Ô∏è felaktiga domar, misstro",
      explain: "Om r√§ttss√§kerheten inte fungerar kan m√§nniskor k√§nna att systemet √§r or√§ttvist, vilket skapar r√§dsla och misstro mot samh√§llet."
    }
  ];

  let usedIndices = [];
  let currentCardIndex = null;
  let score = 0;
  let streak = 0;
  let level = 1;
  let questionsAsked = 0;

  const questionIndexEl = document.getElementById("questionIndex");
  const questionTextEl = document.getElementById("questionText");
  const choicesContainer = document.getElementById("choicesContainer");
  const feedbackIcon = document.getElementById("feedbackIcon");
  const feedbackText = document.getElementById("feedbackText");
  const scoreBadge = document.getElementById("scoreBadge");
  const levelBadge = document.getElementById("levelBadge");
  const streakBadge = document.getElementById("streakBadge");
  const nextButton = document.getElementById("nextButton");
  const hintButton = document.getElementById("hintButton");
  const restartButton = document.getElementById("restartButton");
  const progressFill = document.getElementById("progressFill");
  const quizArea = document.getElementById("quizArea");

  function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function updateStats() {
    scoreBadge.textContent = `‚≠ê Po√§ng: ${score}`;
    streakBadge.textContent = `üî• Streak: ${streak}`;
    levelBadge.textContent = `üèÜ Niv√•: ${level}`;
    const progress = (questionsAsked / cards.length) * 100;
    progressFill.style.width = progress + "%";
  }

  function levelCheck() {
    const oldLevel = level;
    if (score >= 32) level = 4;
    else if (score >= 24) level = 3;
    else if (score >= 16) level = 2;
    else level = 1;
    if (level !== oldLevel) {
      feedbackIcon.textContent = "üèÜ";
      feedbackText.textContent = `Level up! Du √§r nu p√• niv√• ${level}.`;
    }
  }

  function resetGameState() {
    usedIndices = [];
    currentCardIndex = null;
    score = 0;
    streak = 0;
    level = 1;
    questionsAsked = 0;
    answerLog = [];
    progressFill.style.width = "0%";
    questionIndexEl.textContent = "Fr√•ga 1";
    questionTextEl.textContent = "Klicka p√• \"Starta spelet\"";
    choicesContainer.innerHTML = "";
    feedbackIcon.textContent = "üéÆ";
    feedbackText.textContent = "Du kommer att f√• fr√•gor om lag och r√§tt.";
    nextButton.textContent = "‚ñ∂Ô∏è Starta spelet";
    nextButton.disabled = false;
    hintButton.disabled = true;
    updateStats();
  }

  function pickNewCardIndex() {
    if (usedIndices.length === cards.length) return null;
    let idx;
    do {
      idx = Math.floor(Math.random() * cards.length);
    } while (usedIndices.includes(idx));
    usedIndices.push(idx);
    return idx;
  }

  function renderQuestion() {
    const idx = pickNewCardIndex();
    if (idx === null) {
      showEndScreen();
      return;
    }
    currentCardIndex = idx;
    questionsAsked = usedIndices.length;

    const card = cards[idx];
    questionIndexEl.textContent = `Fr√•ga ${questionsAsked} av ${cards.length}`;
    questionTextEl.textContent = card.q;

    const optionOrder = shuffleArray([0,1,2,3]);
    choicesContainer.innerHTML = "";

    optionOrder.forEach((optIndex, i) => {
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.dataset.optionIndex = optIndex;

      const label = document.createElement("span");
      label.style.fontWeight = "600";
      label.style.marginRight = "4px";
      label.textContent = String.fromCharCode(65 + i) + ")";

      const text = document.createElement("span");
      text.textContent = " " + card.options[optIndex];

      btn.appendChild(label);
      btn.appendChild(text);
      btn.addEventListener("click", onChoiceClick);
      choicesContainer.appendChild(btn);
    });

    feedbackIcon.textContent = "‚ùì";
    feedbackText.textContent = "V√§lj det alternativ du tycker passar b√§st.";
    hintButton.disabled = false;
    nextButton.disabled = true;
    nextButton.textContent = "N√§sta fr√•ga";
    updateStats();
  }

  function onChoiceClick(e) {
    const btn = e.currentTarget;
    const chosenIndex = Number(btn.dataset.optionIndex);
    const card = cards[currentCardIndex];
    const isCorrect = chosenIndex === card.correct;

    answerLog.push({
      question: card.q,
      options: card.options.slice(),
      correctIndex: card.correct,
      chosenIndex: chosenIndex,
      correct: isCorrect,
      explain: card.explain
    });

    const allButtons = choicesContainer.querySelectorAll(".choice-btn");
    allButtons.forEach(b => {
      b.classList.add("disabled");
      const idx = Number(b.dataset.optionIndex);
      if (idx === card.correct) b.classList.add("correct");
      if (b === btn && !isCorrect) b.classList.add("wrong");
    });

    if (isCorrect) {
      score += 2;
      streak += 1;
      feedbackIcon.textContent = "‚úÖ";
      feedbackText.textContent = "R√§tt! " + card.explain;
    } else {
      streak = 0;
      feedbackIcon.textContent = "‚ùå";
      feedbackText.textContent = "Inte riktigt. " + card.explain;
    }

    levelCheck();
    updateStats();
    nextButton.disabled = false;
  }

  function showHint() {
    if (currentCardIndex === null) return;
    const card = cards[currentCardIndex];
    alert("St√∂dord: " + card.hint);
    hintButton.disabled = true;
  }

  function showEndScreen() {
    const total = answerLog.length;
    const correctCount = answerLog.filter(x => x.correct).length;
    const accuracy = total > 0 ? Math.round((correctCount / total) * 100) : 0;

    quizArea.innerHTML = "";

    const endDiv = document.createElement("div");

    const h2 = document.createElement("h2");
    h2.textContent = "Spelet √§r slut!";
    endDiv.appendChild(h2);

    const p1 = document.createElement("p");
    p1.textContent = `Du fick ${score} po√§ng och hade ${correctCount} r√§tt av ${total} fr√•gor (${accuracy}%).`;
    endDiv.appendChild(p1);

    const p2 = document.createElement("p");
    p2.textContent = "Klicka p√• en fr√•ga nedan f√∂r att se r√§tt svar och ditt svar.";
    endDiv.appendChild(p2);

    const ul = document.createElement("ul");
    ul.className = "summary-list";

    const detailBox = document.createElement("div");
    detailBox.className = "detail-box";
    detailBox.textContent = "H√§r visas detaljer n√§r du klickar p√• en fr√•ga i listan ovan.";

    answerLog.forEach((entry, i) => {
      const li = document.createElement("li");
      li.className = "summary-item " + (entry.correct ? "correct" : "wrong");

      const icon = entry.correct ? "üü¢" : "üî¥";
      li.textContent = `${icon} Fr√•ga ${i+1}: ${entry.question}`;
      li.style.userSelect = "none";

      li.addEventListener("click", () => {
        const correctText = entry.options[entry.correctIndex];
        const chosenText = entry.options[entry.chosenIndex];

        detailBox.innerHTML = `
          <strong>Fr√•ga:</strong><br>${entry.question}<br><br>
          <strong>Ditt svar:</strong><br>${chosenText || "(inget svar)"}<br><br>
          <strong>R√§tt svar:</strong><br>${correctText}<br><br>
          <strong>F√∂rklaring:</strong><br>${entry.explain}
        `;
      });

      ul.appendChild(li);
    });

    endDiv.appendChild(ul);
    endDiv.appendChild(detailBox);
    quizArea.appendChild(endDiv);
  }

  nextButton.addEventListener("click", () => {
    if (usedIndices.length === 0) {
      renderQuestion();
    } else if (usedIndices.length < cards.length) {
      renderQuestion();
    } else {
      showEndScreen();
    }
  });

  hintButton.addEventListener("click", showHint);

  restartButton.addEventListener("click", () => {
    window.location.reload();
  });

  resetGameState();
</script>
</div>
</body>
</html>
